---
sidebar: sidebar
permalink: task-set-up-permissions-private-mode-azure.html
keywords: networking overview, networking requirements, endpoints, urls, get started, getting started, deployment
summary: You should understand what's needed to get up and running with BlueXP in private mode so that you can prepare your environment.
---

= Set up Azure permissions
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
BlueXP needs permissions to perform actions in Azure. You can grant the required permissions to an Azure account by creating and setting up a service principal in Azure Active Directory and by obtaining the Azure credentials that BlueXP needs.

.About this task

The following image depicts how BlueXP obtains permissions to perform operations in Azure. A service principal object, which is tied to one or more Azure subscriptions, represents BlueXP in Azure Active Directory and is assigned to a custom role that allows the required permissions.

image:diagram_azure_authentication.png["Conceptual image that shows BlueXP obtaining authentication and authorization from Azure Active Directory before it can make an API call. In Active Directory, the BlueXP role defines permissions. It is tied to one or more Azure subscriptions and a service principal object that represents the Cloud Manger application."]

.Steps

. <<Creating an Azure Active Directory application,Create an Azure Active Directory application>>.

. <<Assigning the application to a role,Assign the application to a role>>.

. <<Adding Windows Azure Service Management API permissions,Add Windows Azure Service Management API permissions>>.

. <<Getting the application ID and directory ID,Get the application ID and directory ID>>.

. <<Creating a client secret,Create a client secret>>.

== Creating an Azure Active Directory application

Create an Azure Active Directory (AD) application and service principal that BlueXP can use for role-based access control.

.Before you begin

You must have the right permissions in Azure to create an Active Directory application and to assign the application to a role. For details, refer to https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#required-permissions/[Microsoft Azure Documentation: Required permissions^].

.Steps
. From the Azure portal, open the *Azure Active Directory* service.
+
image:screenshot_azure_ad.gif[Shows the Active Directory service in Microsoft Azure.]

. In the menu, click *App registrations*.

. Click *New registration*.

. Specify details about the application:

* *Name*: Enter a name for the application.
* *Account type*: Select an account type (any will work with BlueXP).
* *Redirect URI*: You can leave this field blank.

. Click *Register*.

.Result

You've created the AD application and service principal.

== Assigning the application to a role

You must bind the service principal to one or more Azure subscriptions and assign it the custom "BlueXP Operator" role so BlueXP has permissions in Azure.

.Steps

. Create a custom role:

.. Copy the contents of the link:reference-permissions-azure.html[custom role permissions for the Connector] and save them in a JSON file.

.. Modify the JSON file by adding Azure subscription IDs to the assignable scope.
+
You should add the ID for each Azure subscription from which users will create Cloud Volumes ONTAP systems.
+
*Example*
+
[source,json]
"AssignableScopes": [
"/subscriptions/d333af45-0d07-4154-943d-c25fbzzzzzzz",
"/subscriptions/54b91999-b3e6-4599-908e-416e0zzzzzzz",
"/subscriptions/398e471c-3b42-4ae7-9b59-ce5bbzzzzzzz"

.. Use the JSON file to create a custom role in Azure.
+
The following steps describe how to create the role by using Bash in Azure Cloud Shell.
+
* Start https://docs.microsoft.com/en-us/azure/cloud-shell/overview[Azure Cloud Shell^] and choose the Bash environment.

* Upload the JSON file.
+
image:screenshot_azure_shell_upload.png[A screenshot of the Azure Cloud Shell where you can choose the option to upload a file.]

* Use the Azure CLI to create the custom role:
+
[source,azurecli]
az role definition create --role-definition Connector_Policy.json
+
You should now have a custom role called BlueXP Operator that you can assign to the Connector virtual machine.

. Assign the application to the role:

.. From the Azure portal, open the *Subscriptions* service.

.. Select the subscription.

.. Click *Access control (IAM) > Add > Add role assignment*.

.. In the *Role* tab, select the *BlueXP Operator* role and click *Next*.

.. In the *Members* tab, complete the following steps:

* Keep *User, group, or service principal* selected.
* Click *Select members*.
+
image:screenshot-azure-service-principal-role.png[A screenshot of the Azure portal that shows the Members tab when adding a role to an application.]
* Search for the name of the application.
+
Here's an example:
+
image:screenshot_azure_service_principal_role.png[A screenshot of the Azure portal that shows the Add role assignment form in the Azure portal.]

* Select the application and click *Select*.
* Click *Next*.

.. Click *Review + assign*.
+
The service principal now has the required Azure permissions to deploy the Connector.
+
If you want to deploy Cloud Volumes ONTAP from multiple Azure subscriptions, then you must bind the service principal to each of those subscriptions. BlueXP enables you to select the subscription that you want to use when deploying Cloud Volumes ONTAP.

== Adding Windows Azure Service Management API permissions

The service principal must have "Windows Azure Service Management API" permissions.

.Steps

. In the *Azure Active Directory* service, click *App registrations* and select the application.

. Click *API permissions > Add a permission*.

. Under *Microsoft APIs*, select *Azure Service Management*.
+
image:screenshot_azure_service_mgmt_apis.gif[A screenshot of the Azure portal that shows the Azure Service Management API permissions.]

. Click *Access Azure Service Management as organization users* and then click *Add permissions*.
+
image:screenshot_azure_service_mgmt_apis_add.gif[A screenshot of the Azure portal that shows adding the Azure Service Management APIs.]

[[ids]]
== Getting the application ID and directory ID

When you add the Azure account to BlueXP, you need to provide the application (client) ID and the directory (tenant) ID for the application. BlueXP uses the IDs to programmatically sign in.

.Steps

. In the *Azure Active Directory* service, click *App registrations* and select the application.

. Copy the *Application (client) ID* and the *Directory (tenant) ID*.
+
image:screenshot_azure_app_ids.gif[A screenshot that shows the application (client) ID and directory (tenant) ID for an application in Azure Active Directory.]

== Creating a client secret

You need to create a client secret and then provide BlueXP with the value of the secret so BlueXP can use it to authenticate with Azure AD.

.Steps

. Open the *Azure Active Directory* service.

. Click *App registrations* and select your application.

. Click *Certificates & secrets > New client secret*.

. Provide a description of the secret and a duration.

. Click *Add*.

. Copy the value of the client secret.
+
image:screenshot_azure_client_secret.gif[A screenshot of the Azure portal that shows a client secret for the Azure AD service principal.]

.Result

Your service principal is now setup and you should have copied the application (client) ID, the directory (tenant) ID, and the value of the client secret. You need to enter this information in BlueXP when you add an Azure account.